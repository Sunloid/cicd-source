// Visit the GroovySyntax.md for the explanation of this pipeline
pipeline {
    agent any
    tools {
	    jdk "OracleJDK8"
	    git "GIT"
	}
    stages{
        stage('Fetch code') {
          steps{
                git branch: 'main', url:'https://github.com/Sunloid/cicd-source'
          }  
        }
   
        stage("Build image and push to dockerhub"){
            steps{
                script{
                     sh """
			def imagetag = "${env.BUILD_ID}" 
                        docker build -t sunloid04/nodeapp:${imagetag} .                     
                        docker tag  sunloid04/nodeapp:${imagetag} sunloid04/nodeapp:latest 
			docker push sunloid04/nodeapp:${imagetag}
			docker push sunloid04/nodeapp:latest
                    """
                }
            }
        }
    }
}
